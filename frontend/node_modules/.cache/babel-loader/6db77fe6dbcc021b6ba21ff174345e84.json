{"ast":null,"code":"import _toConsumableArray from\"/Users/zeninmatvey/Desktop/dev/react-mesto-api-full/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"/Users/zeninmatvey/Desktop/dev/react-mesto-api-full/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React from'react';import Header from'./Header';import Footer from'./Footer';import Main from'./Main';import ImagePopup from'./ImagePopup';import{CurrentUserContext}from'../contexts/CurrentUserContext';import api from'../utils/api';import EditProfilePopup from'./EditProfilePopup';import EditAvatarPopup from'./EditAvatarPopup';import AddPlacePopup from'./AddPlacePopup';import{Route,Switch,useHistory}from'react-router-dom';import ProtectedRoute from'./ProtectedRoute';import Login from'./Login';import Register from'./Rigister';import*as auth from'../utils/auth';import InfoTooltip from'./InfoTooltip';import Success from\"../images/Success.svg\";import unSuccess from\"../images/unSuccess.svg\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function App(){var _React$useState=React.useState(false),_React$useState2=_slicedToArray(_React$useState,2),isEditProfilePopupOpen=_React$useState2[0],setEditProfilePopupOpen=_React$useState2[1];var _React$useState3=React.useState(false),_React$useState4=_slicedToArray(_React$useState3,2),isAddPlacePopupOpen=_React$useState4[0],setAddPlacePopupOpen=_React$useState4[1];var _React$useState5=React.useState(false),_React$useState6=_slicedToArray(_React$useState5,2),isEditAvatarPopupOpen=_React$useState6[0],setEditAvatarPopupOpen=_React$useState6[1];var _React$useState7=React.useState(null),_React$useState8=_slicedToArray(_React$useState7,2),selectedCard=_React$useState8[0],setSelectedCard=_React$useState8[1];var _React$useState9=React.useState({}),_React$useState10=_slicedToArray(_React$useState9,2),currentUser=_React$useState10[0],setCurrentUser=_React$useState10[1];var _React$useState11=React.useState([]),_React$useState12=_slicedToArray(_React$useState11,2),cards=_React$useState12[0],setCards=_React$useState12[1];var _React$useState13=React.useState(false),_React$useState14=_slicedToArray(_React$useState13,2),loggedIn=_React$useState14[0],setLoggedIn=_React$useState14[1];var history=useHistory();var _React$useState15=React.useState(''),_React$useState16=_slicedToArray(_React$useState15,2),email=_React$useState16[0],setEmail=_React$useState16[1];var _React$useState17=React.useState(false),_React$useState18=_slicedToArray(_React$useState17,2),isInfoTooltipOpen=_React$useState18[0],setIsInfoTooltipOpen=_React$useState18[1];var _React$useState19=React.useState({img:'',text:''}),_React$useState20=_slicedToArray(_React$useState19,2),message=_React$useState20[0],setMessage=_React$useState20[1];var _React$useState21=React.useState(''),_React$useState22=_slicedToArray(_React$useState21,2),token=_React$useState22[0],setToken=_React$useState22[1];React.useEffect(function(){if(loggedIn){var jwt=localStorage.getItem('token');console.log(\"\\u044D\\u0442\\u043E\\u0442 \\u0442\\u043E\\u043A\\u0435\\u043D \\u043D\\u0430 \\u0444\\u0440\\u043E\\u043D\\u0442\\u0435 \\u044F \\u043E\\u0442\\u043F\\u0440\\u0430\\u0432\\u043B\\u044F\\u044E \\u043D\\u0430 \\u0437\\u0430\\u043F\\u0440\\u043E\\u0441 \\u0441 \\u0444\\u0440\\u043E\\u043D\\u0442\\u0430 \\u043F\\u043E\\u0441\\u043B\\u0435 \\u043B\\u043E\\u0433\\u0438\\u043D\\u0430 \".concat(jwt));auth.ApiUserInfo(jwt).then(function(user){setCurrentUser(user.data);console.log(user.data);}).catch(function(err){return console.log(err);});}},[loggedIn]);React.useEffect(function(){if(loggedIn){api.getCards().then(function(cards){console.log(cards);setCards(cards.reverse());}).catch(function(err){return console.log(err);});}},[loggedIn]);function onUpdateUser(userData){api.setApiUserInfo(userData).then(function(user){setCurrentUser(user.data);closeAllPopups();}).catch(function(err){return console.log(err);});}function onUpdateAvatar(userData){api.setAvatar(userData).then(function(user){setCurrentUser(user.data);closeAllPopups();}).catch(function(err){return console.log(err);});}function handleAddPlaceSubmit(cardData){api.postCards(cardData).then(function(newCard){console.log(newCard);console.log(cards.data);console.log(cards);setCards([newCard].concat(_toConsumableArray(cards)));closeAllPopups();}).catch(function(err){return console.log(err);});}function handleCardLike(card){// Снова проверяем, есть ли уже лайк на этой карточке\nvar isLiked=card.likes.some(function(id){return id===currentUser._id;});// Отправляем запрос в API и получаем обновлённые данные карточки\napi.changeLikeCardStatus(card._id,!isLiked).then(function(newCard){setCards(function(state){return state.map(function(c){return c._id===card._id?newCard:c;});});}).catch(function(err){return console.log(err);});}function handleCardDelete(card){api.deleteCard(card._id).then(function(){setCards(cards.filter(function(item){return item!==card;}));}).catch(function(err){return console.log(err);});}function handleEditAvatarClick(){setEditAvatarPopupOpen(true);}function handleEditProfileClick(){setEditProfilePopupOpen(true);}function handleAddPlaceClick(){setAddPlacePopupOpen(true);}function onCardClick(card){setSelectedCard(card);}function closeAllPopups(){setEditAvatarPopupOpen(false);setEditProfilePopupOpen(false);setAddPlacePopupOpen(false);setSelectedCard(null);setIsInfoTooltipOpen(false);}React.useEffect(function(){var closeByEscape=function closeByEscape(e){if(e.key==='Escape'){closeAllPopups();}};document.addEventListener('keydown',closeByEscape);return function(){return document.removeEventListener('keydown',closeByEscape);};},[]);React.useEffect(function(){tokenCheck();},[]);function tokenCheck(){var jwt=localStorage.getItem('token');console.log(\"\\u0442\\u043E\\u0447\\u043D\\u043E \\u0442\\u043E\\u0447\\u043D\\u043E \\u0442\\u043E\\u0447\\u043D\\u043E \\u043E\\u043D? \".concat(jwt));if(jwt){auth.getContent(jwt).then(function(res){setLoggedIn(true);setEmail(res.data.email);history.push('/');}).catch(function(err){return console.log(err);});}}// function tokenCheck() {\n//     const jwt = localStorage.getItem('token')\n//     console.log(jwt)\n//     if (jwt) {\n//         auth.getContent(jwt)\n//             .then((res) => {\n//                 setLoggedIn(true)\n//                 setEmail(res.data.email)\n//                 history.push('/')\n//             })\n//             .catch((err) => console.log(err))\n//     }\n// }\nfunction handleRegistration(password,email){auth.register(password,email).then(function(result){setEmail(result.data.email);setMessage({img:Success,text:'Вы успешно зарегистрировались!'});history.push('/sign-in');}).catch(function(){return setMessage({img:unSuccess,text:'Что-то пошло не так! Попробуйте ещё раз.'});}).finally(function(){return setIsInfoTooltipOpen(true);});}function handleAuth(password,email){auth.authorize(password,email).then(function(result){console.log(\"\\u044D\\u0442\\u043E\\u043E\\u043E\\u043E\\u043E\\u043E\\u043E\\u043E \\u043E\\u043D\\u043D\\u043D\\u043D\\u043D\\u043D\\u043D\\u043D \\u043D\\u0430 \\u0444\\u0440\\u043E\\u043D\\u0442\\u0435 \".concat(result.token));localStorage.setItem('token',result.token);var ttt=localStorage.getItem('token');console.log(ttt);setLoggedIn(true);history.push('/');setEmail(email);}).catch(function(err){return console.log(err);});}function onSignOut(){localStorage.removeItem('token');setToken('');var jwt=localStorage.getItem('token');console.log(jwt);setLoggedIn(false);}return/*#__PURE__*/_jsx(CurrentUserContext.Provider,{value:currentUser,children:/*#__PURE__*/_jsxs(\"div\",{className:\"page\",children:[/*#__PURE__*/_jsx(Header,{loggedIn:loggedIn,email:email,onSignOut:onSignOut}),/*#__PURE__*/_jsxs(Switch,{children:[/*#__PURE__*/_jsx(ProtectedRoute,{exact:true,path:\"/\",loggedIn:loggedIn,component:Main,onEditAvatar:handleEditAvatarClick,onEditProfile:handleEditProfileClick,onAddPlace:handleAddPlaceClick,onCardClick:onCardClick,handleCardLike:handleCardLike,handleCardDelete:handleCardDelete,cards:cards}),/*#__PURE__*/_jsx(Route,{path:\"/sign-in\",children:/*#__PURE__*/_jsx(Register,{isOpen:isEditProfilePopupOpen,onRegister:handleRegistration,isInfoTooltipOpen:isInfoTooltipOpen})}),/*#__PURE__*/_jsx(Route,{path:\"/sign-up\",children:/*#__PURE__*/_jsx(Login,{isOpen:isEditProfilePopupOpen,onAuth:handleAuth})})]}),/*#__PURE__*/_jsx(Footer,{}),/*#__PURE__*/_jsx(InfoTooltip,{name:\"tooltip\",isOpen:isInfoTooltipOpen,onClose:closeAllPopups,title:message.text,img:message.img}),/*#__PURE__*/_jsx(AddPlacePopup,{isOpen:isAddPlacePopupOpen,onClose:closeAllPopups,onAddPlace:handleAddPlaceSubmit}),/*#__PURE__*/_jsx(EditProfilePopup,{isOpen:isEditProfilePopupOpen,onClose:closeAllPopups,onUpdateUser:onUpdateUser}),/*#__PURE__*/_jsx(ImagePopup,{card:selectedCard,onClose:closeAllPopups}),/*#__PURE__*/_jsx(EditAvatarPopup,{isOpen:isEditAvatarPopupOpen,onClose:closeAllPopups,onUpdateAvatar:onUpdateAvatar})]})});}export default App;","map":{"version":3,"sources":["/Users/zeninmatvey/Desktop/dev/react-mesto-api-full/frontend/src/components/App.jsx"],"names":["React","Header","Footer","Main","ImagePopup","CurrentUserContext","api","EditProfilePopup","EditAvatarPopup","AddPlacePopup","Route","Switch","useHistory","ProtectedRoute","Login","Register","auth","InfoTooltip","App","useState","isEditProfilePopupOpen","setEditProfilePopupOpen","isAddPlacePopupOpen","setAddPlacePopupOpen","isEditAvatarPopupOpen","setEditAvatarPopupOpen","selectedCard","setSelectedCard","currentUser","setCurrentUser","cards","setCards","loggedIn","setLoggedIn","history","email","setEmail","isInfoTooltipOpen","setIsInfoTooltipOpen","img","text","message","setMessage","token","setToken","useEffect","jwt","localStorage","getItem","console","log","ApiUserInfo","then","user","data","catch","err","getCards","reverse","onUpdateUser","userData","setApiUserInfo","closeAllPopups","onUpdateAvatar","setAvatar","handleAddPlaceSubmit","cardData","postCards","newCard","handleCardLike","card","isLiked","likes","some","id","_id","changeLikeCardStatus","state","map","c","handleCardDelete","deleteCard","filter","item","handleEditAvatarClick","handleEditProfileClick","handleAddPlaceClick","onCardClick","closeByEscape","e","key","document","addEventListener","removeEventListener","tokenCheck","getContent","res","push","handleRegistration","password","register","result","Success","unSuccess","finally","handleAuth","authorize","setItem","ttt","onSignOut","removeItem"],"mappings":"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","sourcesContent":["\nimport React from 'react'\nimport Header from './Header'\nimport Footer from './Footer'\nimport Main from './Main'\nimport ImagePopup from './ImagePopup'\nimport { CurrentUserContext } from '../contexts/CurrentUserContext'\nimport api from '../utils/api'\nimport EditProfilePopup from './EditProfilePopup'\nimport EditAvatarPopup from './EditAvatarPopup'\nimport AddPlacePopup from './AddPlacePopup'\nimport { Route, Switch, useHistory } from 'react-router-dom'\nimport ProtectedRoute from './ProtectedRoute'\nimport Login from './Login'\nimport Register from './Rigister'\nimport * as auth from '../utils/auth'\nimport InfoTooltip from './InfoTooltip'\nimport Success from '../images/Success.svg'\nimport unSuccess from '../images/unSuccess.svg'\n\n\nfunction App() {\n\n    const [isEditProfilePopupOpen, setEditProfilePopupOpen] = React.useState(false)\n    const [isAddPlacePopupOpen, setAddPlacePopupOpen] = React.useState(false)\n    const [isEditAvatarPopupOpen, setEditAvatarPopupOpen] = React.useState(false)\n    const [selectedCard, setSelectedCard] = React.useState(null)\n    const [currentUser, setCurrentUser] = React.useState({})\n    const [cards, setCards] = React.useState([])\n    const [loggedIn, setLoggedIn] = React.useState(false)\n    const history = useHistory()\n    const [email, setEmail] = React.useState('')\n    const [isInfoTooltipOpen, setIsInfoTooltipOpen] = React.useState(false)\n    const [message, setMessage] = React.useState({ img: '', text: '' })\n    const [token, setToken] = React.useState('')\n\n    React.useEffect(() => {\n        if (loggedIn) {\n            const jwt = localStorage.getItem('token')\n            console.log(`этот токен на фронте я отправляю на запрос с фронта после логина ${jwt}`)\n\n            auth.ApiUserInfo(jwt)\n                .then((user) => {\n                    setCurrentUser(user.data)\n                    console.log(user.data)\n                })\n                .catch((err) => console.log(err))\n        }\n\n    }, [loggedIn])\n\n    React.useEffect(() => {\n        if (loggedIn) {\n            api.getCards()\n                .then((cards) => {\n                    console.log(cards);\n                    setCards(cards.reverse())\n                })\n                .catch((err) => console.log(err))\n        }\n    }, [loggedIn])\n\n    function onUpdateUser(userData) {\n        api.setApiUserInfo(userData)\n            .then((user) => {\n                setCurrentUser(user.data)\n                closeAllPopups()\n            })\n            .catch((err) => console.log(err))\n    }\n\n    function onUpdateAvatar(userData) {\n        api.setAvatar(userData)\n            .then((user) => {\n                setCurrentUser(user.data)\n                closeAllPopups()\n            })\n            .catch((err) => console.log(err))\n    }\n\n    function handleAddPlaceSubmit(cardData) {\n        api.postCards(cardData)\n            .then((newCard) => {\n                console.log(newCard);\n                console.log(cards.data);\n                console.log(cards);\n                setCards([newCard, ...cards]);\n                closeAllPopups()\n            })\n            .catch((err) => console.log(err))\n    }\n\n    function handleCardLike(card) {\n        // Снова проверяем, есть ли уже лайк на этой карточке\n        const isLiked = card.likes.some(id => id === currentUser._id);\n\n        // Отправляем запрос в API и получаем обновлённые данные карточки\n        api.changeLikeCardStatus(card._id, !isLiked)\n            .then((newCard) => {\n                setCards((state) => state.map((c) => c._id === card._id ? newCard : c));\n            })\n            .catch((err) => console.log(err))\n    }\n\n    function handleCardDelete(card) {\n        api.deleteCard(card._id)\n            .then(() => {\n                setCards(cards.filter((item) => item !== card))\n            })\n            .catch((err) => console.log(err))\n    }\n\n    function handleEditAvatarClick() {\n        setEditAvatarPopupOpen(true)\n    }\n\n    function handleEditProfileClick() {\n        setEditProfilePopupOpen(true)\n    }\n\n    function handleAddPlaceClick() {\n        setAddPlacePopupOpen(true)\n    }\n\n    function onCardClick(card) {\n        setSelectedCard(card)\n    }\n\n    function closeAllPopups() {\n        setEditAvatarPopupOpen(false)\n        setEditProfilePopupOpen(false)\n        setAddPlacePopupOpen(false)\n        setSelectedCard(null)\n        setIsInfoTooltipOpen(false)\n    }\n\n    React.useEffect(() => {\n        const closeByEscape = (e) => {\n            if (e.key === 'Escape') {\n                closeAllPopups();\n            }\n        }\n\n        document.addEventListener('keydown', closeByEscape)\n\n        return () => document.removeEventListener('keydown', closeByEscape)\n    }, [])\n\n\n    React.useEffect(() => {\n        tokenCheck()\n    }, [])\n\n    function tokenCheck() {\n        const jwt = localStorage.getItem('token')\n        console.log(`точно точно точно он? ${jwt}`)\n\n        if (jwt) {\n            auth.getContent(jwt)\n                .then((res) => {\n                    setLoggedIn(true)\n                    setEmail(res.data.email)\n                    history.push('/')\n                })\n                .catch((err) => console.log(err))\n        }\n    }\n\n    // function tokenCheck() {\n    //     const jwt = localStorage.getItem('token')\n    //     console.log(jwt)\n\n    //     if (jwt) {\n    //         auth.getContent(jwt)\n    //             .then((res) => {\n    //                 setLoggedIn(true)\n    //                 setEmail(res.data.email)\n    //                 history.push('/')\n    //             })\n    //             .catch((err) => console.log(err))\n    //     }\n    // }\n\n    function handleRegistration(password, email) {\n        auth.register(password, email)\n            .then((result) => {\n                setEmail(result.data.email)\n                setMessage({ img: Success, text: 'Вы успешно зарегистрировались!' })\n                history.push('/sign-in')\n            })\n            .catch(() => setMessage({ img: unSuccess, text: 'Что-то пошло не так! Попробуйте ещё раз.' }))\n            .finally(() => setIsInfoTooltipOpen(true))\n    }\n\n    function handleAuth(password, email) {\n        auth.authorize(password, email)\n            .then((result) => {\n                console.log(`этоооооооо онннннннн на фронте ${result.token}`)\n\n                localStorage.setItem('token', result.token)\n                const ttt = localStorage.getItem('token');\n\n                console.log(ttt);\n                setLoggedIn(true)\n                history.push('/')\n                setEmail(email)\n            })\n            .catch((err) => console.log(err))\n    }\n\n    function onSignOut() {\n        localStorage.removeItem('token')\n        setToken('')\n        const jwt = localStorage.getItem('token');\n        console.log(jwt)\n        setLoggedIn(false)\n\n    }\n\n\n    return (\n        <CurrentUserContext.Provider value={currentUser}>\n            <div className=\"page\">\n                <Header loggedIn={loggedIn} email={email} onSignOut={onSignOut} />\n                <Switch>\n                    <ProtectedRoute exact path='/' loggedIn={loggedIn} component={Main} onEditAvatar={handleEditAvatarClick} onEditProfile={handleEditProfileClick} onAddPlace={handleAddPlaceClick} onCardClick={onCardClick} handleCardLike={handleCardLike} handleCardDelete={handleCardDelete} cards={cards} />\n                    <Route path='/sign-in'>\n                        <Register isOpen={isEditProfilePopupOpen} onRegister={handleRegistration} isInfoTooltipOpen={isInfoTooltipOpen} />\n                    </Route>\n                    <Route path='/sign-up'>\n                        <Login isOpen={isEditProfilePopupOpen} onAuth={handleAuth} />\n                    </Route>\n                </Switch>\n                <Footer />\n\n                <InfoTooltip name='tooltip' isOpen={isInfoTooltipOpen} onClose={closeAllPopups} title={message.text} img={message.img} />\n\n                <AddPlacePopup isOpen={isAddPlacePopupOpen} onClose={closeAllPopups} onAddPlace={handleAddPlaceSubmit} />\n\n                <EditProfilePopup isOpen={isEditProfilePopupOpen} onClose={closeAllPopups} onUpdateUser={onUpdateUser} />\n\n                <ImagePopup card={selectedCard} onClose={closeAllPopups} />\n\n                <EditAvatarPopup isOpen={isEditAvatarPopupOpen} onClose={closeAllPopups} onUpdateAvatar={onUpdateAvatar} />\n            </div>\n        </CurrentUserContext.Provider >\n    );\n}\n\nexport default App;"]},"metadata":{},"sourceType":"module"}